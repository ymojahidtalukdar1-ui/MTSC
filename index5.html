
<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>এসো পড়ি - পড়া শেয়ারিং</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kalpurush', 'Segoe UI', sans-serif;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #38a169;
            --danger: #e53e3e;
            --warning: #dd6b20;
            --light: #f7fafc;
            --dark: #2d3748;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Authentication Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            padding: 40px 30px;
            position: relative;
        }

        .admin-login-corner {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .admin-settings-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
            transition: transform 0.3s ease;
        }

        .admin-settings-btn:hover {
            transform: rotate(90deg);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .logo p {
            color: #718096;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f7fafc;
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        .phone-input {
            display: flex;
            align-items: center;
        }

        .country-code {
            background: #f7fafc;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-right: none;
            border-radius: 10px 0 0 10px;
            font-weight: 600;
            color: var(--primary);
        }

        .phone-input input {
            border-radius: 0 10px 10px 0;
        }

        button {
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .btn-full {
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #4a5568;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
        }

        .message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
        }

        /* App Styles */
        .app-container {
            display: none;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: auto;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: none;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Dashboard Styles */
        .welcome-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .welcome-card h2 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .date-display {
            color: #718096;
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .action-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        /* Search Bar Styles */
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .search-input {
            flex: 1;
        }
        
        .class-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            display: none;
        }
        
        .class-filter {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .class-filter:hover {
            background: #edf2f7;
        }
        
        .class-filter.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .toggle-class-filters {
            text-align: center;
            margin-top: 10px;
        }

        .toggle-class-filters button {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            width: auto;
            padding: 8px 16px;
        }

        /* Add Study Material Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        /* File Upload Styles */
        .file-upload-container {
            margin-top: 10px;
        }

        .file-upload-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .file-upload-input input {
            flex: 1;
        }

        .file-preview {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }

        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Study Materials List */
        .study-materials {
            display: grid;
            gap: 20px;
        }

        .material-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
            position: relative;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .material-title {
            font-size: 20px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .material-class {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .material-date {
            color: #718096;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .material-author {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #718096;
            font-size: 14px;
            font-style: italic;
        }

        .author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .material-content {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .material-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .material-image {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .material-image:hover {
            transform: scale(1.05);
        }

        .homework {
            background: #fffaf0;
            border: 1px solid #fed7aa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .homework h4 {
            color: var(--warning);
            margin-bottom: 8px;
        }

        .material-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .delete-btn {
            background: var(--danger);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .edit-btn {
            background: var(--warning);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .no-materials {
            text-align: center;
            padding: 50px 20px;
            color: #718096;
        }

        .no-materials h3 {
            margin-bottom: 10px;
        }

        /* Admin Only Styles */
        .admin-only {
            border: 2px solid var(--danger);
        }

        .admin-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--danger);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Admin Panel Styles */
        .admin-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-panel h3 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-control-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .admin-control-card h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .admin-control-card p {
            color: #718096;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #718096;
        }

        /* User Profile Styles */
        .profile-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }

        .profile-info h3 {
            color: var(--dark);
            margin-bottom: 5px;
        }

        .profile-info p {
            color: #718096;
        }

        /* Users List Styles */
        .users-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 3px solid var(--primary);
        }

        .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Admin Setup Styles */
        .admin-setup {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-setup h3 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Profile Update Section */
        .profile-update-section {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed #cbd5e0;
        }

        .profile-update-section h4 {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #718096;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .image-modal-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .auth-box {
                padding: 30px 20px;
            }
            
            .material-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .material-actions {
                flex-direction: column;
            }
            
            .admin-controls {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .users-list {
                grid-template-columns: 1fr;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .class-filters {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box">
            <div class="admin-login-corner">
                <button class="admin-settings-btn" onclick="handleAdminLogin()">⚙️</button>
            </div>

            <div class="logo">
                <h1>এসো পড়ি</h1>
                <p>প্রতিদিনের পড়া শেয়ারিং প্ল্যাটফর্ম</p>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="login">লগইন</div>
                <div class="tab" data-tab="signup">সাইন আপ</div>
            </div>

            <!-- Login Form -->
            <div class="form-container active" id="login-form">
                <div class="form-group">
                    <label for="login-phone">ফোন নম্বর</label>
                    <div class="phone-input">
                        <div class="country-code">+880</div>
                        <input type="text" id="login-phone" placeholder="1XXXXXXXXX" maxlength="10">
                    </div>
                    <small style="color: #718096; font-size: 12px;">বাংলাদেশী ফোন নম্বর দিন (+8801XXXXXXXXX)</small>
                </div>
                <div class="form-group">
                    <label for="login-password">পাসওয়ার্ড</label>
                    <input type="password" id="login-password" placeholder="আপনার পাসওয়ার্ড দিন">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="remember-me"> আমাকে মনে রাখুন
                    </label>
                </div>
                <button class="btn-full" id="login-btn">লগইন করুন</button>
                
                <div class="message" id="login-message"></div>
            </div>

            <!-- Sign Up Form -->
            <div class="form-container" id="signup-form">
                <div class="form-group">
                    <label for="signup-name">পুরো নাম</label>
                    <input type="text" id="signup-name" placeholder="আপনার পুরো নাম দিন">
                </div>
                <div class="form-group">
                    <label for="signup-phone">ফোন নম্বর</label>
                    <div class="phone-input">
                        <div class="country-code">+880</div>
                        <input type="text" id="signup-phone" placeholder="1XXXXXXXXX" maxlength="10">
                    </div>
                    <small style="color: #718096; font-size: 12px;">বাংলাদেশী ফোন নম্বর দিন (+8801XXXXXXXXX)</small>
                </div>
                <div class="form-group">
                    <label for="signup-password">পাসওয়ার্ড</label>
                    <input type="password" id="signup-password" placeholder="নতুন পাসওয়ার্ড তৈরি করুন">
                </div>
                <div class="form-group">
                    <label for="signup-class">ক্লাস</label>
                    <select id="signup-class">
                        <option value="">ক্লাস নির্বাচন করুন</option>
                        <option value="6">ষষ্ঠ শ্রেণী</option>
                        <option value="7">সপ্তম শ্রেণী</option>
                        <option value="8">অষ্টম শ্রেণী</option>
                        <option value="9">নবম শ্রেণী</option>
                        <option value="10">দশম শ্রেণী</option>
                        <option value="ssc">এসএসসি পরীক্ষার্থী</option>
                        <option value="11">একাদশ শ্রেণী (এইচএসসি প্রথম বর্ষ)</option>
                        <option value="12">দ্বাদশ শ্রেণী (এইচএসসি দ্বিতীয় বর্ষ)</option>
                    </select>
                </div>
                <button class="btn-full" id="signup-btn">একাউন্ট তৈরি করুন</button>
                <div class="message" id="signup-message"></div>
            </div>
        </div>
    </div>

    <!-- User App Section -->
    <div class="app-container" id="user-app">
        <div class="header">
            <div class="nav">
                <div class="logo">
                    <h1>এসো পড়ি</h1>
                    <p>প্রতিদিনের পড়া শেয়ারিং প্ল্যাটফর্ম</p>
                </div>
                <div class="user-info">
                    <img id="user-avatar" src="" alt="User Avatar" class="user-avatar" onerror="this.src='https://via.placeholder.com/40'">
                    <span id="user-name">স্টুডেন্ট</span>
                    <button class="logout-btn" id="user-logout-btn">লগআউট</button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Search Bar Section -->
            <div class="search-container">
                <div class="search-bar">
                    <div class="search-input">
                        <input type="text" id="search-input" placeholder="বিষয় বা টপিক সার্চ করুন...">
                    </div>
                    <button class="btn-full" id="search-btn" style="width: auto; padding: 12px 20px;">সার্চ করুন</button>
                </div>
                
                <div class="toggle-class-filters">
                    <button id="toggle-class-btn">ক্লাস ফিল্টার দেখুন</button>
                </div>
                
                <div class="class-filters" id="class-filters">
                    <div class="class-filter active" data-class="all">সকল শ্রেণী</div>
                    <div class="class-filter" data-class="6">ষষ্ঠ শ্রেণী</div>
                    <div class="class-filter" data-class="7">সপ্তম শ্রেণী</div>
                    <div class="class-filter" data-class="8">অষ্টম শ্রেণী</div>
                    <div class="class-filter" data-class="9">নবম শ্রেণী</div>
                    <div class="class-filter" data-class="10">দশম শ্রেণী</div>
                    <div class="class-filter" data-class="ssc">এসএসসি পরীক্ষার্থী</div>
                    <div class="class-filter" data-class="11">একাদশ শ্রেণী</div>
                    <div class="class-filter" data-class="12">দ্বাদশ শ্রেণী</div>
                </div>
            </div>

            <div class="welcome-card">
                <h2 id="welcome-text">স্বাগতম!</h2>
                <div class="date-display" id="current-date"></div>
                <p>আপনার পড়া শেয়ার করুন এবং অন্যদের পড়া দেখুন</p>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="action-card" onclick="openShareModal()">
                    <div class="action-icon">📚</div>
                    <h3>পড়া শেয়ার করুন</h3>
                    <p>নতুন পড়া শেয়ার করুন</p>
                </div>
                <div class="action-card" onclick="toggleProfileSection()">
                    <div class="action-icon">👤</div>
                    <h3>প্রোফাইল</h3>
                    <p>আপনার প্রোফাইল ম্যানেজ করুন</p>
                </div>
                <div class="action-card" onclick="viewAllMaterials()">
                    <div class="action-icon">📖</div>
                    <h3>সকল পড়া</h3>
                    <p>সকল শেয়ার করা পড়া দেখুন</p>
                </div>
            </div>

            <!-- Admin Panel (Only for Admin) -->
            <div class="admin-panel" id="admin-panel" style="display: none;">
                <h3>এডমিন কন্ট্রোল প্যানেল</h3>
                
                <div class="admin-controls">
                    <div class="admin-control-card">
                        <h4>ব্যবহারকারী ম্যানেজ করুন</h4>
                        <p>সকল রেজিস্টার্ড ব্যবহারকারী দেখুন এবং ম্যানেজ করুন</p>
                        <button class="btn-full" onclick="showAllUsers()">ব্যবহারকারী দেখুন</button>
                    </div>
                    <div class="admin-control-card">
                        <h4>সিস্টেম পরিসংখ্যান</h4>
                        <p>সিস্টেমের সামগ্রিক পরিসংখ্যান দেখুন</p>
                        <button class="btn-full" onclick="showSystemStats()">পরিসংখ্যান দেখুন</button>
                    </div>
                    <div class="admin-control-card">
                        <h4>এডমিন সেটিংস</h4>
                        <p>এডমিন একাউন্ট সেটিংস পরিবর্তন করুন</p>
                        <button class="btn-full" onclick="openAdminSettings()">সেটিংস</button>
                    </div>
                </div>
                
                <div class="admin-stats" id="admin-stats">
                    <!-- Admin stats will be loaded here -->
                </div>
            </div>

            <!-- User Profile Section -->
            <div class="profile-section" id="profile-section">
                <div class="profile-header">
                    <img id="profile-avatar" src="" alt="Profile Avatar" class="profile-avatar" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="profile-info">
                        <h3 id="profile-name">নাম</h3>
                        <p id="profile-class">ক্লাস</p>
                        <p id="profile-phone">ফোন নম্বর</p>
                    </div>
                </div>
                
                <!-- Profile Update Section (Hidden by default) -->
                <div class="profile-update-section" id="profile-update-section" style="display: none;">
                    <h4>প্রোফাইল আপডেট করুন</h4>
                    <div class="form-group">
                        <label for="profile-avatar-url">প্রোফাইল ছবির URL</label>
                        <input type="url" id="profile-avatar-url" placeholder="আপনার প্রোফাইল ছবির URL দিন">
                    </div>
                    
                    <div class="form-group">
                        <label for="profile-class-select">শ্রেণী পরিবর্তন করুন</label>
                        <select id="profile-class-select">
                            <option value="6">ষষ্ঠ শ্রেণী</option>
                            <option value="7">সপ্তম শ্রেণী</option>
                            <option value="8">অষ্টম শ্রেণী</option>
                            <option value="9">নবম শ্রেণী</option>
                            <option value="10">দশম শ্রেণী</option>
                            <option value="ssc">এসএসসি পরীক্ষার্থী</option>
                            <option value="11">একাদশ শ্রেণী (এইচএসসি প্রথম বর্ষ)</option>
                            <option value="12">দ্বাদশ শ্রেণী (এইচএসসি দ্বিতীয় বর্ষ)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-password">নতুন পাসওয়ার্ড</label>
                        <input type="password" id="new-password" placeholder="নতুন পাসওয়ার্ড দিন">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">পাসওয়ার্ড নিশ্চিত করুন</label>
                        <input type="password" id="confirm-password" placeholder="পাসওয়ার্ড আবার দিন">
                    </div>
                    
                    <button class="btn-success" id="update-profile-btn">প্রোফাইল আপডেট করুন</button>
                    <div class="message" id="profile-message"></div>
                </div>
                
                <button class="btn-full" onclick="toggleProfileUpdate()" id="toggle-profile-btn">প্রোফাইল আপডেট দেখুন</button>
            </div>

            <!-- Users List (Admin Only) -->
            <div class="users-list" id="users-list" style="display: none;">
                <!-- Users will be loaded here -->
            </div>

            <!-- Study Materials List -->
            <div class="study-materials" id="study-materials">
                <!-- পড়ার ম্যাটেরিয়ালগুলো এখানে লোড হবে -->
            </div>
        </div>
    </div>

    <!-- Share Study Material Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeShareModal()">&times;</span>
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">নতুন পড়া শেয়ার করুন</h3>
            
            <form id="add-material-form">
                <div class="form-group">
                    <label for="material-subject">বিষয় *</label>
                    <input type="text" id="material-subject" placeholder="যেমন: বাংলা, ইংরেজি, গণিত..." required>
                </div>
                <div class="form-group">
                    <label for="material-topic">টপিক *</label>
                    <input type="text" id="material-topic" placeholder="আজকের পড়ার টপিক" required>
                </div>
                <div class="form-group">
                    <label for="material-description">বিস্তারিত বর্ণনা *</label>
                    <textarea id="material-description" placeholder="আজকের পড়ার বিস্তারিত বর্ণনা লিখুন..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="material-homework">বাড়ির কাজ</label>
                    <textarea id="material-homework" placeholder="বাড়ির কাজ লিখুন (যদি থাকে)"></textarea>
                </div>
                <div class="form-group">
                    <label>ছবি আপলোড করুন</label>
                    <div class="file-upload-container">
                        <input type="file" id="file-upload" accept="image/*" multiple style="display: none;">
                        <button type="button" class="btn-full" onclick="document.getElementById('file-upload').click()">ছবি আপলোড করুন</button>
                        <div class="file-preview" id="file-preview"></div>
                    </div>
                </div>
                <button type="submit" class="btn-full">📚 পড়া শেয়ার করুন</button>
            </form>
            <div class="message" id="material-message"></div>
        </div>
    </div>

    <!-- Edit Study Material Modal -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">পড়া এডিট করুন</h3>
            
            <form id="edit-material-form">
                <input type="hidden" id="edit-material-id">
                <div class="form-group">
                    <label for="edit-material-subject">বিষয় *</label>
                    <input type="text" id="edit-material-subject" placeholder="যেমন: বাংলা, ইংরেজি, গণিত..." required>
                </div>
                <div class="form-group">
                    <label for="edit-material-topic">টপিক *</label>
                    <input type="text" id="edit-material-topic" placeholder="আজকের পড়ার টপিক" required>
                </div>
                <div class="form-group">
                    <label for="edit-material-description">বিস্তারিত বর্ণনা *</label>
                    <textarea id="edit-material-description" placeholder="আজকের পড়ার বিস্তারিত বর্ণনা লিখুন..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-material-homework">বাড়ির কাজ</label>
                    <textarea id="edit-material-homework" placeholder="বাড়ির কাজ লিখুন (যদি থাকে)"></textarea>
                </div>
                <div class="form-group">
                    <label>ছবি আপলোড করুন</label>
                    <div class="file-upload-container">
                        <input type="file" id="edit-file-upload" accept="image/*" multiple style="display: none;">
                        <button type="button" class="btn-full" onclick="document.getElementById('edit-file-upload').click()">ছবি আপলোড করুন</button>
                        <div class="file-preview" id="edit-file-preview"></div>
                    </div>
                </div>
                <button type="submit" class="btn-success">💾 পরিবর্তন সেভ করুন</button>
            </form>
            <div class="message" id="edit-message"></div>
        </div>
    </div>

    <!-- Admin Settings Modal -->
    <div class="modal" id="admin-settings-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdminSettings()">&times;</span>
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">এডমিন সেটিংস</h3>
            
            <div class="form-group">
                <label for="admin-username">এডমিন ইউজারনেম</label>
                <input type="text" id="admin-username" placeholder="এডমিন ইউজারনেম">
            </div>
            <div class="form-group">
                <label for="admin-password">এডমিন পাসওয়ার্ড</label>
                <input type="password" id="admin-password" placeholder="নতুন এডমিন পাসওয়ার্ড">
            </div>
            <div class="form-group">
                <label for="admin-confirm-password">পাসওয়ার্ড নিশ্চিত করুন</label>
                <input type="password" id="admin-confirm-password" placeholder="পাসওয়ার্ড আবার দিন">
            </div>
            
            <button class="btn-success" id="save-admin-settings">এডমিন সেটিংস সেভ করুন</button>
            <div class="message" id="admin-message"></div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="image-modal">
        <div class="image-modal-content">
            <img id="modal-image" src="" alt="Study Material Image">
        </div>
    </div>

    <script>
        // ==================== উন্নত স্টোরেজ ম্যানেজমেন্ট সিস্টেম ====================
        
        // উন্নত স্টোরেজ ম্যানেজার ক্লাস
        class AdvancedStorage {
            constructor() {
                this.localCache = new Map();
                this.lastSync = Date.now();
                this.syncInterval = 30000; // 30 seconds
                this.maxLocalItems = 1000; // লোকাল স্টোরেজে সর্বোচ্চ আইটেম (বাড়ানো হয়েছে)
                this.compressionEnabled = true;
                this.backupInterval = 60000; // 1 minute
                this.init();
            }
            
            init() {
                // ব্যাকআপ ইন্টারভাল সেটআপ
                setInterval(() => {
                    this.createBackup();
                }, this.backupInterval);
                
                // সিঙ্ক ইন্টারভাল সেটআপ
                setInterval(() => {
                    this.syncWithCloud();
                }, this.syncInterval);
            }
            
            // লোকাল স্টোরেজে সেভ
            saveToLocal(key, data) {
                try {
                    // পুরোনো ডাটা ক্লিনআপ
                    this.cleanupLocalStorage();
                    
                    // কম্প্রেশন প্রয়োগ
                    const processedData = this.compressData(data);
                    localStorage.setItem(key, processedData);
                    this.localCache.set(key, data);
                    return true;
                } catch (error) {
                    console.error('Local storage error:', error);
                    return false;
                }
            }
            
            // লোকাল স্টোরেজ থেকে লোড
            loadFromLocal(key) {
                try {
                    // ক্যাশ থেকে চেক করুন
                    if (this.localCache.has(key)) {
                        return this.localCache.get(key);
                    }
                    
                    const data = localStorage.getItem(key);
                    if (data) {
                        const parsedData = this.decompressData(data);
                        this.localCache.set(key, parsedData);
                        return parsedData;
                    }
                    return null;
                } catch (error) {
                    console.error('Local storage load error:', error);
                    return null;
                }
            }
            
            // হাইব্রিড সেভ (লোকাল + ক্লাউড)
            async hybridSave(key, data) {
                // প্রথমে লোকালে সেভ
                this.saveToLocal(key, data);
            }
            
            // হাইব্রিড লোড
            async hybridLoad(key) {
                // প্রথমে লোকাল থেকে লোড
                let data = this.loadFromLocal(key);
                
                return data || [];
            }
            
            // ডাটা কম্প্রেশন
            compressData(data) {
                if (!this.compressionEnabled) {
                    return JSON.stringify(data);
                }
                
                try {
                    // সরল কম্প্রেশন - বড় স্ট্রিং কম্প্রেস
                    const jsonString = JSON.stringify(data);
                    // বেসিক কম্প্রেশন (বাস্তবে LZ-String ব্যবহার করা যেতে পারে)
                    return btoa(unescape(encodeURIComponent(jsonString)));
                } catch (error) {
                    console.warn('Compression failed, using normal JSON');
                    return JSON.stringify(data);
                }
            }
            
            // ডাটা ডিকম্প্রেশন
            decompressData(data) {
                if (!this.compressionEnabled) {
                    return JSON.parse(data);
                }
                
                try {
                    // বেসিক ডিকম্প্রেশন
                    const decompressed = decodeURIComponent(escape(atob(data)));
                    return JSON.parse(decompressed);
                } catch (error) {
                    // কম্প্রেশন না হলে সাধারণ JSON পার্স
                    try {
                        return JSON.parse(data);
                    } catch (e) {
                        console.error('Decompression failed:', e);
                        return null;
                    }
                }
            }
            
            // লোকাল স্টোরেজ ক্লিনআপ
            cleanupLocalStorage() {
                const materials = this.loadFromLocal('studyMaterials') || [];
                if (materials.length > this.maxLocalItems) {
                    // পুরোনো ২০% ডাটা রিমুভ
                    const removeCount = Math.floor(this.maxLocalItems * 0.2);
                    const recentMaterials = materials.slice(-this.maxLocalItems);
                    this.saveToLocal('studyMaterials', recentMaterials);
                    
                    console.log(`Cleaned up ${removeCount} old materials`);
                }
            }
            
            // ব্যাকআপ তৈরি
            createBackup() {
                try {
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const backupData = {
                        timestamp: timestamp,
                        users: this.loadFromLocal('users') || [],
                        materials: this.loadFromLocal('studyMaterials') || [],
                        adminCredentials: this.loadFromLocal('adminCredentials') || {}
                    };
                    
                    localStorage.setItem(`backup_${timestamp}`, JSON.stringify(backupData));
                    
                    // পুরোনো ব্যাকআপ ডিলিট (শুধু ৫টি রাখুন)
                    this.cleanupOldBackups();
                } catch (error) {
                    console.error('Backup creation failed:', error);
                }
            }
            
            // পুরোনো ব্যাকআপ ক্লিনআপ
            cleanupOldBackups() {
                const backups = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('backup_')) {
                        backups.push(key);
                    }
                }
                
                // তারিখ অনুযায়ী সাজান
                backups.sort();
                
                // শুধু শেষের ৫টি ব্যাকআপ রাখুন
                while (backups.length > 5) {
                    const oldestBackup = backups.shift();
                    localStorage.removeItem(oldestBackup);
                }
            }
            
            // স্টোরেজ হেলথ চেক
            getStorageHealth() {
                const totalSize = JSON.stringify(localStorage).length;
                const maxSize = 5 * 1024 * 1024; // 5MB
                const usagePercent = (totalSize / maxSize) * 100;
                
                return {
                    used: this.formatBytes(totalSize),
                    max: this.formatBytes(maxSize),
                    percent: usagePercent.toFixed(1),
                    status: usagePercent > 90 ? 'danger' : usagePercent > 70 ? 'warning' : 'healthy'
                };
            }
            
            // বাইটস ফরম্যাট
            formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // ক্লাউড সিঙ্ক
            async syncWithCloud() {
                // No cloud sync in this version
            }
            
            // স্টোরেজ পরিসংখ্যান
            getStorageStats() {
                const stats = {
                    users: (this.loadFromLocal('users') || []).length,
                    materials: (this.loadFromLocal('studyMaterials') || []).length,
                    backups: 0,
                    totalSize: 0
                };
                
                // ব্যাকআপ গণনা
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('backup_')) {
                        stats.backups++;
                    }
                    stats.totalSize += localStorage.getItem(key).length;
                }
                
                return stats;
            }
        }
        
        // স্টোরেজ ম্যানেজার ইনিশিয়ালাইজ
        const storageManager = new AdvancedStorage();
        
        // ==================== সার্চ এবং ফিল্টার সিস্টেম ====================
        
        let currentSearchQuery = '';
        let currentFilterClass = 'all';
        
        // সার্চ ফাংশনালিটি
        document.getElementById('search-btn').addEventListener('click', function() {
            currentSearchQuery = document.getElementById('search-input').value;
            loadStudyMaterials();
        });
        
        // এন্টার কী দিয়ে সার্চ
        document.getElementById('search-input').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                currentSearchQuery = this.value;
                loadStudyMaterials();
            }
        });
        
        // ক্লাস ফিল্টার টগল
        document.getElementById('toggle-class-btn').addEventListener('click', function() {
            const classFilters = document.getElementById('class-filters');
            if (classFilters.style.display === 'none' || classFilters.style.display === '') {
                classFilters.style.display = 'flex';
                this.textContent = 'ক্লাস ফিল্টার লুকান';
            } else {
                classFilters.style.display = 'none';
                this.textContent = 'ক্লাস ফিল্টার দেখুন';
            }
        });
        
        // ক্লাস ফিল্টার ইভেন্ট
        document.querySelectorAll('.class-filter').forEach(filter => {
            filter.addEventListener('click', function() {
                // সক্রিয় ক্লাস আপডেট
                document.querySelectorAll('.class-filter').forEach(f => f.classList.remove('active'));
                this.classList.add('active');
                
                currentFilterClass = this.getAttribute('data-class');
                loadStudyMaterials();
            });
        });
        
        // ==================== মূল অ্যাপ লজিক ====================
        
        // ডিফল্ট এডমিন ক্রেডেনশিয়াল
        const DEFAULT_ADMIN_USERNAME = "admin";
        const DEFAULT_ADMIN_PASSWORD = "admin123";

        // বাংলাদেশী ফোন নম্বর ভ্যালিডেশন
        function validateBangladeshiPhone(phone) {
            const regex = /^1[3-9]\d{8}$/;
            return regex.test(phone);
        }

        // ফোন নম্বর ফরম্যাট করুন
        function formatPhoneNumber(phone) {
            return '+880' + phone;
        }

        // শ্রেণীর নাম ফরম্যাট করুন
        function getClassName(classValue) {
            const classNames = {
                '6': 'ষষ্ঠ শ্রেণী',
                '7': 'সপ্তম শ্রেণী',
                '8': 'অষ্টম শ্রেণী',
                '9': 'নবম শ্রেণী',
                '10': 'দশম শ্রেণী',
                'ssc': 'এসএসসি পরীক্ষার্থী',
                '11': 'একাদশ শ্রেণী',
                '12': 'দ্বাদশ শ্রেণী',
                'admin': 'এডমিন'
            };
            return classNames[classValue] || 'অজানা শ্রেণী';
        }

        // ফাইল আপলোড হ্যান্ডলিং
        document.getElementById('file-upload').addEventListener('change', function(e) {
            const files = e.target.files;
            const previewContainer = document.getElementById('file-preview');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'file-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button type="button" class="remove-file" onclick="this.parentElement.remove()">×</button>
                        `;
                        previewContainer.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // এডিট মোডে ফাইল আপলোড হ্যান্ডলিং
        document.getElementById('edit-file-upload').addEventListener('change', function(e) {
            const files = e.target.files;
            const previewContainer = document.getElementById('edit-file-preview');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'file-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button type="button" class="remove-file" onclick="this.parentElement.remove()">×</button>
                        `;
                        previewContainer.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // আপলোড করা ফাইল থেকে URL সংগ্রহ করুন
        function getUploadedImageUrls() {
            const previewItems = document.querySelectorAll('#file-preview img');
            const urls = [];
            previewItems.forEach(img => {
                urls.push(img.src);
            });
            return urls;
        }

        // এডিট মোডে আপলোড করা ফাইল থেকে URL সংগ্রহ করুন
        function getEditUploadedImageUrls() {
            const previewItems = document.querySelectorAll('#edit-file-preview img');
            const urls = [];
            previewItems.forEach(img => {
                urls.push(img.src);
            });
            return urls;
        }

        // তারিখ ফরম্যাট করুন
        function formatDate(date) {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('bn-BD', options);
        }

        // মডেল খুলুন এবং বন্ধ করুন
        function openShareModal() {
            document.getElementById('share-modal').style.display = 'flex';
        }

        function closeShareModal() {
            document.getElementById('share-modal').style.display = 'none';
            document.getElementById('add-material-form').reset();
            document.getElementById('material-message').innerHTML = '';
            
            // ফাইল প্রিভিউ ক্লিয়ার করুন
            document.getElementById('file-preview').innerHTML = '';
        }

        function openEditModal(materialId) {
            const materials = storageManager.loadFromLocal('studyMaterials') || [];
            const material = materials.find(m => m.id === materialId);
            
            if (material) {
                document.getElementById('edit-material-id').value = material.id;
                document.getElementById('edit-material-subject').value = material.subject;
                document.getElementById('edit-material-topic').value = material.topic;
                document.getElementById('edit-material-description').value = material.description;
                document.getElementById('edit-material-homework').value = material.homework || '';
                
                // ফাইল প্রিভিউ ক্লিয়ার করুন
                document.getElementById('edit-file-preview').innerHTML = '';
                
                document.getElementById('edit-modal').style.display = 'flex';
            }
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            document.getElementById('edit-material-form').reset();
            document.getElementById('edit-message').innerHTML = '';
        }

        function openAdminSettings() {
            const adminCredentials = storageManager.loadFromLocal('adminCredentials') || {};
            document.getElementById('admin-username').value = adminCredentials.username || '';
            document.getElementById('admin-settings-modal').style.display = 'flex';
        }

        function closeAdminSettings() {
            document.getElementById('admin-settings-modal').style.display = 'none';
            document.getElementById('admin-message').innerHTML = '';
        }

        // ইমেজ মডেল খুলুন
        function openImageModal(imageUrl) {
            document.getElementById('modal-image').src = imageUrl;
            document.getElementById('image-modal').style.display = 'flex';
        }

        // ইমেজ মডেল বন্ধ করুন
        function closeImageModal() {
            document.getElementById('image-modal').style.display = 'none';
        }

        // প্রোফাইল সেকশন টগল করুন
        function toggleProfileSection() {
            const profileSection = document.getElementById('profile-section');
            if (profileSection.style.display === 'none' || profileSection.style.display === '') {
                profileSection.style.display = 'block';
                loadProfileData();
            } else {
                profileSection.style.display = 'none';
            }
        }

        // প্রোফাইল আপডেট সেকশন টগল করুন
        function toggleProfileUpdate() {
            const updateSection = document.getElementById('profile-update-section');
            const toggleBtn = document.getElementById('toggle-profile-btn');
            
            if (updateSection.style.display === 'none' || updateSection.style.display === '') {
                updateSection.style.display = 'block';
                toggleBtn.textContent = 'প্রোফাইল আপডেট লুকান';
            } else {
                updateSection.style.display = 'none';
                toggleBtn.textContent = 'প্রোফাইল আপডেট দেখুন';
            }
        }

        // প্রোফাইল ডাটা লোড করুন
        function loadProfileData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                document.getElementById('profile-name').textContent = currentUser.name;
                document.getElementById('profile-class').textContent = getClassName(currentUser.class);
                document.getElementById('profile-phone').textContent = currentUser.phone;
                document.getElementById('profile-avatar').src = currentUser.avatar || 'https://via.placeholder.com/80';
                
                // প্রোফাইল আপডেট ফর্ম সেট করুন
                document.getElementById('profile-avatar-url').value = currentUser.avatar || '';
                document.getElementById('profile-class-select').value = currentUser.class;
            }
        }

        // স্টাডি ম্যাটেরিয়াল লোড করুন (সার্চ এবং ফিল্টার সহ)
        async function loadStudyMaterials() {
            try {
                // হাইব্রিড লোড ব্যবহার করুন
                const materials = await storageManager.hybridLoad('studyMaterials');
                
                // ফিল্টার প্রয়োগ করুন
                let filteredMaterials = materials;
                
                // ক্লাস ফিল্টার
                if (currentFilterClass !== 'all') {
                    filteredMaterials = filteredMaterials.filter(material => 
                        material.class === currentFilterClass
                    );
                }
                
                // সার্চ কোয়েরি ফিল্টার
                if (currentSearchQuery.trim() !== '') {
                    const query = currentSearchQuery.toLowerCase();
                    filteredMaterials = filteredMaterials.filter(material => 
                        material.subject.toLowerCase().includes(query) ||
                        material.topic.toLowerCase().includes(query) ||
                        material.description.toLowerCase().includes(query)
                    );
                }
                
                // সাজানো (নতুন থেকে পুরানো)
                filteredMaterials.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // UI আপডেট
                displayStudyMaterials(filteredMaterials);
                
            } catch (error) {
                console.error('Error loading study materials:', error);
                document.getElementById('study-materials').innerHTML = `
                    <div class="error-message">
                        <p>ডাটা লোড করতে সমস্যা হচ্ছে। দয়া করে আবার চেষ্টা করুন।</p>
                    </div>
                `;
            }
        }

        // স্টাডি ম্যাটেরিয়াল ডিসপ্লে
        function displayStudyMaterials(materials) {
            const container = document.getElementById('study-materials');
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            if (materials.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>কোন পড়া পাওয়া যায়নি</h3>
                        <p>${currentSearchQuery || currentFilterClass !== 'all' ? 'সার্চ বা ফিল্টার পরিবর্তন করে আবার চেষ্টা করুন' : 'প্রথম পড়া শেয়ার করুন!'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = materials.map(material => {
                const isAuthor = material.authorPhone === currentUser.phone;
                const isAdmin = currentUser.type === 'admin';
                
                return `
                <div class="material-card ${isAdmin ? 'admin-only' : ''}">
                    ${isAdmin ? '<div class="admin-badge">এডমিন</div>' : ''}
                    <div class="material-header">
                        <div>
                            <h3 class="material-title">${material.subject} - ${material.topic}</h3>
                            <div class="material-date">
                                ${new Date(material.date).toLocaleDateString('bn-BD')} 
                            </div>
                            <div class="material-author">
                                ${material.authorAvatar ? `<img src="${material.authorAvatar}" alt="Author" class="author-avatar" onerror="this.style.display='none'">` : ''}
                                ${material.author} (${getClassName(material.class)})
                            </div>
                        </div>
                        <div class="material-class">${getClassName(material.class)}</div>
                    </div>
                    <div class="material-content">
                        <p>${material.description}</p>
                    </div>
                    ${material.imageUrls && material.imageUrls.length > 0 ? `
                        <div class="material-images">
                            ${material.imageUrls.map(url => `
                                <img src="${url}" alt="Study Material" class="material-image" onclick="openImageModal('${url}')" onerror="this.style.display='none'">
                            `).join('')}
                        </div>
                    ` : ''}
                    ${material.homework ? `
                        <div class="homework">
                            <h4>🏠 বাড়ির কাজ</h4>
                            <p>${material.homework}</p>
                        </div>
                    ` : ''}
                    <div class="material-actions">
                        ${(isAdmin || isAuthor) ? `
                            <button class="edit-btn" onclick="openEditModal(${material.id})">✏️ এডিট</button>
                        ` : ''}
                        ${isAdmin ? `
                            <button class="delete-btn" onclick="deleteMaterial(${material.id})">🗑️ মুছুন</button>
                        ` : ''}
                    </div>
                </div>
                `;
            }).join('');
        }

        // ==================== ইভেন্ট লিসেনার ====================

        // DOM কন্টেন্ট লোড হওয়ার পর
        document.addEventListener('DOMContentLoaded', function() {
            // বর্তমান তারিখ সেট করুন
            updateDate();
            
            // স্টোরেজ ম্যানেজার ইনিশিয়ালাইজ করুন
            initializeStorage();
            
            // অ্যাপ স্টেট চেক করুন
            checkAppState();
            
            // ইভেন্ট লিসেনার যোগ করুন
            setupEventListeners();
        });

        // তারিখ আপডেট
        function updateDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('current-date').textContent = now.toLocaleDateString('bn-BD', options);
        }

        // স্টোরেজ ইনিশিয়ালাইজেশন
        function initializeStorage() {
            // ডিফল্ট এডমিন ক্রেডেনশিয়াল সেট করুন
            const existingAdmin = storageManager.loadFromLocal('adminCredentials');
            if (!existingAdmin || !existingAdmin.username) {
                storageManager.saveToLocal('adminCredentials', {
                    username: DEFAULT_ADMIN_USERNAME,
                    password: DEFAULT_ADMIN_PASSWORD
                });
            }
            
            // ডিফল্ট ডাটা সেট করুন যদি না থাকে
            const existingUsers = storageManager.loadFromLocal('users');
            if (!existingUsers || existingUsers.length === 0) {
                storageManager.saveToLocal('users', []);
            }
            
            const existingMaterials = storageManager.loadFromLocal('studyMaterials');
            if (!existingMaterials || existingMaterials.length === 0) {
                storageManager.saveToLocal('studyMaterials', []);
            }
        }

        // অ্যাপ স্টেট চেক
        function checkAppState() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                showUserApp();
                loadStudyMaterials();
            } else {
                showAuth();
            }
        }

        // ইভেন্ট লিসেনার সেটআপ
        function setupEventListeners() {
            // ট্যাব সিস্টেম
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // সক্রিয় ট্যাব আপডেট
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ফর্ম সক্রিয় করুন
                    document.querySelectorAll('.form-container').forEach(form => {
                        form.classList.remove('active');
                    });
                    document.getElementById(`${tabName}-form`).classList.add('active');
                });
            });
            
            // লগইন ফর্ম
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // সাইনআপ ফর্ম
            document.getElementById('signup-btn').addEventListener('click', handleSignup);
            
            // লগআউট
            document.getElementById('user-logout-btn').addEventListener('click', handleLogout);
            
            // পড়া শেয়ার ফর্ম
            document.getElementById('add-material-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addStudyMaterial();
            });
            
            // পড়া এডিট ফর্ম
            document.getElementById('edit-material-form').addEventListener('submit', function(e) {
                e.preventDefault();
                updateStudyMaterial();
            });
            
            // প্রোফাইল আপডেট ফর্ম
            document.getElementById('update-profile-btn').addEventListener('click', updateProfile);
            
            // এডমিন সেটিংস সেভ
            document.getElementById('save-admin-settings').addEventListener('click', saveAdminSettings);
            
            // ইমেজ মডেল বন্ধ করার ইভেন্ট
            document.getElementById('image-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeImageModal();
                }
            });
        }

        // লগইন হ্যান্ডলার
        function handleLogin() {
            const phone = document.getElementById('login-phone').value;
            const password = document.getElementById('login-password').value;
            
            if (!validateBangladeshiPhone(phone)) {
                showMessage('login-message', 'দয়া করে একটি বৈধ বাংলাদেশী ফোন নম্বর দিন', 'error');
                return;
            }
            
            if (!password) {
                showMessage('login-message', 'দয়া করে পাসওয়ার্ড দিন', 'error');
                return;
            }
            
            const formattedPhone = formatPhoneNumber(phone);
            const users = storageManager.loadFromLocal('users') || [];
            const user = users.find(u => u.phone === formattedPhone && u.password === password);
            
            if (user) {
                // লগইন সফল
                localStorage.setItem('currentUser', JSON.stringify(user));
                showUserApp();
                loadStudyMaterials();
                showMessage('login-message', 'সফলভাবে লগইন করা হয়েছে!', 'success');
            } else {
                showMessage('login-message', 'ভুল ফোন নম্বর বা পাসওয়ার্ড', 'error');
            }
        }

        // সাইনআপ হ্যান্ডলার
        function handleSignup() {
            const name = document.getElementById('signup-name').value;
            const phone = document.getElementById('signup-phone').value;
            const password = document.getElementById('signup-password').value;
            const classValue = document.getElementById('signup-class').value;
            
            if (!name) {
                showMessage('signup-message', 'দয়া করে আপনার নাম দিন', 'error');
                return;
            }
            
            if (!validateBangladeshiPhone(phone)) {
                showMessage('signup-message', 'দয়া করে একটি বৈধ বাংলাদেশী ফোন নম্বর দিন', 'error');
                return;
            }
            
            if (!password) {
                showMessage('signup-message', 'দয়া করে পাসওয়ার্ড দিন', 'error');
                return;
            }
            
            if (!classValue) {
                showMessage('signup-message', 'দয়া করে আপনার শ্রেণী নির্বাচন করুন', 'error');
                return;
            }
            
            const formattedPhone = formatPhoneNumber(phone);
            const users = storageManager.loadFromLocal('users') || [];
            
            // চেক করুন যদি ইউজার ইতিমধ্যে থাকে
            if (users.find(u => u.phone === formattedPhone)) {
                showMessage('signup-message', 'এই ফোন নম্বর দিয়ে ইতিমধ্যে একটি একাউন্ট রয়েছে', 'error');
                return;
            }
            
            // নতুন ইউজার তৈরি করুন
            const newUser = {
                name: name,
                phone: formattedPhone,
                password: password,
                class: classValue,
                type: 'student',
                avatar: ''
            };
            
            users.push(newUser);
            storageManager.hybridSave('users', users);
            
            showMessage('signup-message', 'একাউন্ট সফলভাবে তৈরি হয়েছে! এখন লগইন করুন', 'success');
            
            // লগইন ট্যাবে সুইচ করুন
            document.querySelector('.tab[data-tab="login"]').click();
            document.getElementById('login-phone').value = phone;
        }

        // এডমিন লগইন হ্যান্ডলার
        function handleAdminLogin() {
            const username = prompt("এডমিন ইউজারনেম দিন:");
            const password = prompt("এডমিন পাসওয়ার্ড দিন:");
            
            if (!username || !password) {
                alert("দয়া করে ইউজারনেম এবং পাসওয়ার্ড দিন");
                return;
            }
            
            // এডমিন ক্রেডেনশিয়াল চেক
            const adminCredentials = storageManager.loadFromLocal('adminCredentials') || {
                username: DEFAULT_ADMIN_USERNAME,
                password: DEFAULT_ADMIN_PASSWORD
            };
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                const adminUser = {
                    name: "সিস্টেম এডমিন",
                    phone: "admin",
                    type: "admin"
                };
                
                localStorage.setItem('currentUser', JSON.stringify(adminUser));
                showUserApp();
                loadStudyMaterials();
                showMessage('login-message', 'এডমিন হিসেবে সফলভাবে লগইন করা হয়েছে!', 'success');
            } else {
                alert("ভুল এডমিন ইউজারনেম বা পাসওয়ার্ড");
            }
        }

        // লগআউট হ্যান্ডলার
        function handleLogout() {
            localStorage.removeItem('currentUser');
            showAuth();
            showMessage('login-message', 'সফলভাবে লগআউট করা হয়েছে', 'success');
        }

        // পড়া শেয়ার যোগ করুন
        function addStudyMaterial() {
            const subject = document.getElementById('material-subject').value;
            const topic = document.getElementById('material-topic').value;
            const description = document.getElementById('material-description').value;
            const homework = document.getElementById('material-homework').value;
            const uploadedImageUrls = getUploadedImageUrls();
            
            if (!subject || !topic || !description) {
                showMessage('material-message', 'দয়া করে বিষয়, টপিক এবং বর্ণনা পূরণ করুন', 'error');
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const materials = storageManager.loadFromLocal('studyMaterials') || [];
            
            const newMaterial = {
                id: Date.now(),
                subject: subject,
                topic: topic,
                description: description,
                homework: homework,
                imageUrls: uploadedImageUrls,
                author: currentUser.name,
                authorPhone: currentUser.phone,
                authorAvatar: currentUser.avatar || '',
                class: currentUser.class,
                date: new Date().toISOString()
            };
            
            materials.push(newMaterial);
            storageManager.hybridSave('studyMaterials', materials);
            
            showMessage('material-message', 'পড়া সফলভাবে শেয়ার করা হয়েছে!', 'success');
            closeShareModal();
            loadStudyMaterials();
        }

        // পড়া আপডেট করুন
        function updateStudyMaterial() {
            const materialId = parseInt(document.getElementById('edit-material-id').value);
            const subject = document.getElementById('edit-material-subject').value;
            const topic = document.getElementById('edit-material-topic').value;
            const description = document.getElementById('edit-material-description').value;
            const homework = document.getElementById('edit-material-homework').value;
            const uploadedImageUrls = getEditUploadedImageUrls();
            
            if (!subject || !topic || !description) {
                showMessage('edit-message', 'দয়া করে বিষয়, টপিক এবং বর্ণনা পূরণ করুন', 'error');
                return;
            }
            
            const materials = storageManager.loadFromLocal('studyMaterials') || [];
            const materialIndex = materials.findIndex(m => m.id === materialId);
            
            if (materialIndex !== -1) {
                materials[materialIndex].subject = subject;
                materials[materialIndex].topic = topic;
                materials[materialIndex].description = description;
                materials[materialIndex].homework = homework;
                materials[materialIndex].imageUrls = uploadedImageUrls;
                materials[materialIndex].date = new Date().toISOString();
                
                storageManager.hybridSave('studyMaterials', materials);
                
                showMessage('edit-message', 'পড়া সফলভাবে আপডেট করা হয়েছে!', 'success');
                setTimeout(() => {
                    closeEditModal();
                    loadStudyMaterials();
                }, 1000);
            }
        }

        // পড়া ডিলিট করুন
        function deleteMaterial(materialId) {
            if (confirm('আপনি কি নিশ্চিত যে আপনি এই পড়া ডিলিট করতে চান?')) {
                const materials = storageManager.loadFromLocal('studyMaterials') || [];
                const filteredMaterials = materials.filter(m => m.id !== materialId);
                
                storageManager.hybridSave('studyMaterials', filteredMaterials);
                loadStudyMaterials();
            }
        }

        // প্রোফাইল আপডেট করুন
        function updateProfile() {
            const avatarUrl = document.getElementById('profile-avatar-url').value;
            const newClass = document.getElementById('profile-class-select').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = storageManager.loadFromLocal('users') || [];
            const userIndex = users.findIndex(u => u.phone === currentUser.phone);
            
            if (userIndex !== -1) {
                // আপডেট প্রয়োগ করুন
                if (avatarUrl) {
                    users[userIndex].avatar = avatarUrl;
                    currentUser.avatar = avatarUrl;
                }
                
                if (newClass) {
                    users[userIndex].class = newClass;
                    currentUser.class = newClass;
                }
                
                if (newPassword) {
                    if (newPassword === confirmPassword) {
                        users[userIndex].password = newPassword;
                    } else {
                        showMessage('profile-message', 'পাসওয়ার্ড মেলে না', 'error');
                        return;
                    }
                }
                
                storageManager.hybridSave('users', users);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showMessage('profile-message', 'প্রোফাইল সফলভাবে আপডেট করা হয়েছে!', 'success');
                loadProfileData();
                
                // ইউজার ইন্টারফেস আপডেট
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').src = currentUser.avatar || 'https://via.placeholder.com/40';
                document.getElementById('welcome-text').textContent = `${currentUser.name}, স্বাগতম!`;
                
                loadStudyMaterials();
            }
        }

        // এডমিন সেটিংস সেভ করুন
        function saveAdminSettings() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const confirmPassword = document.getElementById('admin-confirm-password').value;
            
            const adminCredentials = storageManager.loadFromLocal('adminCredentials') || {};
            
            if (username) {
                adminCredentials.username = username;
            }
            
            if (password) {
                if (password === confirmPassword) {
                    adminCredentials.password = password;
                } else {
                    showMessage('admin-message', 'পাসওয়ার্ড মেলে না', 'error');
                    return;
                }
            }
            
            storageManager.saveToLocal('adminCredentials', adminCredentials);
            showMessage('admin-message', 'এডমিন সেটিংস সফলভাবে সেভ করা হয়েছে!', 'success');
        }

        // ইউটিলিটি ফাংশন
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `message ${type}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function showAuth() {
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('user-app').style.display = 'none';
        }

        function showUserApp() {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('user-app').style.display = 'block';
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.name + (currentUser.type === 'admin' ? ' (এডমিন)' : '');
                document.getElementById('user-avatar').src = currentUser.avatar || 'https://via.placeholder.com/40';
                document.getElementById('welcome-text').textContent = `${currentUser.name}, ${currentUser.type === 'admin' ? 'এডমিন ড্যাশবোর্ডে' : ''} স্বাগতম!`;
                
                // এডমিন প্যানেল শো/হাইড
                if (currentUser.type === 'admin') {
                    document.getElementById('admin-panel').style.display = 'block';
                    loadAdminStats();
                } else {
                    document.getElementById('admin-panel').style.display = 'none';
                }
            }
        }

        function viewAllMaterials() {
            document.getElementById('study-materials').scrollIntoView({ behavior: 'smooth' });
        }

        // এডমিন ফাংশন
        function showAllUsers() {
            const users = storageManager.loadFromLocal('users') || [];
            const students = users.filter(u => u.type === 'student');
            const container = document.getElementById('users-list');
            
            if (students.length === 0) {
                container.innerHTML = '<p>কোনো ব্যবহারকারী পাওয়া যায়নি</p>';
            } else {
                container.innerHTML = students.map(user => `
                    <div class="user-card">
                        <img src="${user.avatar || 'https://via.placeholder.com/80'}" alt="User Avatar" class="user-avatar-large" onerror="this.src='https://via.placeholder.com/80'">
                        <h3>${user.name}</h3>
                        <p>${getClassName(user.class)}</p>
                        <p>${user.phone}</p>
                        <p>পাসওয়ার্ড: ${user.password}</p>
                        <div class="user-actions">
                            <button class="btn-success" onclick="changeUserPassword('${user.phone}')">পাসওয়ার্ড পরিবর্তন</button>
                            <button class="btn-danger" onclick="deleteUser('${user.phone}')">ডিলিট</button>
                        </div>
                    </div>
                `).join('');
            }
            
            container.style.display = 'grid';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function loadAdminStats() {
            const users = storageManager.loadFromLocal('users') || [];
            const materials = storageManager.loadFromLocal('studyMaterials') || [];
            const statsContainer = document.getElementById('admin-stats');
            
            const totalUsers = users.length;
            const totalMaterials = materials.length;
            const totalStudents = users.filter(u => u.type === 'student').length;
            const totalClasses = [...new Set(materials.map(m => m.class))].length;
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalUsers}</div>
                    <div class="stat-label">মোট ব্যবহারকারী</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalStudents}</div>
                    <div class="stat-label">মোট শিক্ষার্থী</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalMaterials}</div>
                    <div class="stat-label">মোট পড়া</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalClasses}</div>
                    <div class="stat-label">ক্লাস সংখ্যা</div>
                </div>
            `;
        }

        function showSystemStats() {
            const users = storageManager.loadFromLocal('users') || [];
            const materials = storageManager.loadFromLocal('studyMaterials') || [];
            const students = users.filter(u => u.type === 'student');
            
            let message = `সিস্টেম পরিসংখ্যান:\n\n`;
            message += `• মোট ব্যবহারকারী: ${users.length}\n`;
            message += `• মোট শিক্ষার্থী: ${students.length}\n`;
            message += `• মোট পড়া: ${materials.length}\n`;
            
            // ক্লাস অনুযায়ী পরিসংখ্যান
            const classStats = {};
            materials.forEach(material => {
                if (!classStats[material.class]) {
                    classStats[material.class] = 0;
                }
                classStats[material.class]++;
            });
            
            message += `\nক্লাস অনুযায়ী পড়া:\n`;
            for (const [className, count] of Object.entries(classStats)) {
                message += `• ${getClassName(className)}: ${count}\n`;
            }
            
            alert(message);
        }

        function changeUserPassword(phone) {
            const newPassword = prompt("নতুন পাসওয়ার্ড দিন:");
            if (!newPassword) return;
            
            const users = storageManager.loadFromLocal('users') || [];
            const userIndex = users.findIndex(u => u.phone === phone);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                storageManager.hybridSave('users', users);
                alert("পাসওয়ার্ড সফলভাবে পরিবর্তন করা হয়েছে");
                showAllUsers();
            }
        }

        function deleteUser(phone) {
            if (confirm("আপনি কি নিশ্চিত যে আপনি এই ব্যবহারকারী ডিলিট করতে চান?")) {
                const users = storageManager.loadFromLocal('users') || [];
                const filteredUsers = users.filter(u => u.phone !== phone);
                
                storageManager.hybridSave('users', filteredUsers);
                showAllUsers();
                loadAdminStats();
            }
        }

        // উইন্ডোতে ফাংশন এক্সপোজ করুন
        window.openShareModal = openShareModal;
        window.closeShareModal = closeShareModal;
        window.openEditModal = openEditModal;
        window.closeEditModal = closeEditModal;
        window.openAdminSettings = openAdminSettings;
        window.closeAdminSettings = closeAdminSettings;
        window.toggleProfileSection = toggleProfileSection;
        window.toggleProfileUpdate = toggleProfileUpdate;
        window.viewAllMaterials = viewAllMaterials;
        window.openImageModal = openImageModal;
        window.closeImageModal = closeImageModal;
        window.deleteMaterial = deleteMaterial;
        window.showAllUsers = showAllUsers;
        window.showSystemStats = showSystemStats;
        window.changeUserPassword = changeUserPassword;
        window.deleteUser = deleteUser;
        window.handleAdminLogin = handleAdminLogin;
    </script>
</body>
</html>